<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Deepdots Popup SDK Demo</title>
  <style>
    body {font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif;max-width:900px;margin:0 auto;padding:40px 20px;line-height:1.5;background:#fafafa;}
    h1 {color:#333;border-bottom:2px solid #4CAF50;padding-bottom:10px;}
    .controls {background:#f5f5f5;padding:20px;border-radius:8px;margin:20px 0;display:flex;flex-wrap:wrap;gap:8px;}
    button {background:#4CAF50;color:#fff;border:none;padding:12px 18px;border-radius:4px;cursor:pointer;font-size:14px;}
    button:hover {background:#45a049;}
    button.secondary {background:#2196F3;}
    button.secondary:hover {background:#0b7dda;}
    button.outline {background:#fff;color:#333;border:1px solid #ccc;}
    button.outline:hover {background:#eee;}
    .event-log {background:#222;color:#f1f1f1;padding:14px;border-radius:6px;font-family:'Courier New',monospace;font-size:12px;max-height:280px;overflow-y:auto;margin:20px 0;}
    .event-log .event {margin:4px 0;padding:4px 6px;border-left:3px solid #4CAF50;}
    .content {margin:40px 0;min-height:1200px;}
    .section {margin:20px 0;padding:20px;background:#fff;border:1px solid #ddd;border-radius:6px;}
    .badge {display:inline-block;background:#4CAF50;color:#fff;padding:2px 6px;font-size:11px;border-radius:3px;margin-left:6px;}
  </style>
    <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <h1>游빍 Demo Deepdots Popup SDK</h1>
  <p>Esta demo usa el SDK real en <strong>modo client</strong> con definiciones de popups fake y renderiza encuestas con MagicFeedback.</p>

  <div class="controls">
    <button id="btn-show-popup1">Mostrar Popup 1</button>
    <button id="btn-show-popup2" class="secondary">Mostrar Popup 2</button>
    <button id="btn-autolaunch" class="secondary">Activar AutoLaunch</button>
    <button id="btn-mark-answered" class="outline">Marcar encuesta 1 contestada</button>
    <button id="btn-force-survey" class="outline">Forzar trigger encuesta 2</button>
    <button id="btn-clear-log" class="outline">Limpiar Log</button>
  </div>

  <div>
    <h2>Eventos</h2>
    <div class="event-log" id="event-log"><div class="event">Esperando eventos...</div></div>
  </div>

  <div class="content">
    <div class="section">
      <h2>Definiciones Fake <span class="badge">client mode</span></h2>
      <p>Se precargan dos popups para demostrar los diferentes tipos de trigger y condiciones:</p>
      <ul>
        <li><strong>Popup 1</strong>: Trigger <code>time_on_page</code> (3s) con cooldown 1 d칤a y condici칩n answered:false.</li>
        <li><strong>Popup 2</strong>: Trigger <code>scroll</code> (40%) sin cooldown.</li>
      </ul>
      <p>Ambas encuestas usan IDs ficticios (<code>survey-001</code> y <code>survey-002</code>) y claves p칰blicas fake para generar el formulario (<code>publicKey</code>).</p>
    </div>
    <div class="section">
      <h2>Scroll de prueba</h2>
      <p>Despl치zate para activar el trigger de scroll (40%). Texto de relleno...</p>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</p>
      <p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
      <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.</p>
      <p>Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
      <p>Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium.</p>
      <p>Totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.</p>
      <p>Fin del contenido de prueba.</p>
    </div>
  </div>

  <script type="module">
    // IMPORTACI칍N DEL SDK (usar build previo: npm run build)
    import { DeepdotsPopups } from '../dist/index.mjs';

    // Definiciones fake de popups en modo client
    const popupDefinitions = [
      {
        id: 'popup-demo-1',
        title: '쯅os ayudas a mejorar?',
        message: '<p>Tu opini칩n r치pida nos ayuda a crecer 游</p>',
        trigger: { type: 'time_on_page', value: 3, condition: [{ answered: false, cooldownDays: 1 }] },
        actions: { accept: { label: 'Responder', surveyId: 'a9c8c170-bb1c-11f0-9d29-d5fe3dd521d0' }, decline: { label: 'Cerrar', cooldownDays: 1 } },
        surveyId: 'a9c8c170-bb1c-11f0-9d29-d5fe3dd521d0',
        productId: '02b809f20e024bce47c57f123cff8735',
        style: { theme: 'light', position: 'bottom-right', imageUrl: null },
        segments: { lang: ['es'], path: ['/'] }
      },
      {
        id: 'popup-demo-2',
        title: 'Encuesta de experiencia',
        message: '<p>Nos interesa tu experiencia mientras navegas.</p>',
        trigger: { type: 'scroll', value: 40 },
        actions: { accept: { label: 'Participar', surveyId: 'dc278020-bb1c-11f0-aedb-5b3735c7e119' }, decline: { label: 'Ahora no' } },
        surveyId: 'dc278020-bb1c-11f0-aedb-5b3735c7e119',
        productId: '02b809f20e024bce47c57f123cff8735',
        style: { theme: 'dark', position: 'bottom-right', imageUrl: null },
        segments: { lang: ['es'], path: ['/'] }
      }
    ];

    // Inicializaci칩n del SDK en modo client
    const sdk = new DeepdotsPopups();
    sdk.init({
      mode: 'client',
      debug: true,
      popups: popupDefinitions
    });

    // Log de eventos
    const logEl = document.getElementById('event-log');
    function logEvent(ev) {
      const line = document.createElement('div');
      line.className = 'event';
      line.textContent = `[${new Date(ev.timestamp).toLocaleTimeString()}] ${ev.type} - survey:${ev.surveyId}`;
      logEl.appendChild(line);
      logEl.scrollTop = logEl.scrollHeight;
    }

    sdk.on('popup_shown', logEvent);
    sdk.on('popup_clicked', logEvent);
    sdk.on('survey_completed', logEvent);

    // Botones
    document.getElementById('btn-show-popup1').onclick = () => {
        console.log('clicked');
      // mostramos con datos que incluyen publicKey fake para intentar generar MagicFeedback
      sdk.show({ surveyId: 'a9c8c170-bb1c-11f0-9d29-d5fe3dd521d0', productId:'02b809f20e024bce47c57f123cff8735', data: { origen: 'boton_popup1' } });
    };
    document.getElementById('btn-show-popup2').onclick = () => {
      sdk.show({ surveyId: 'dc278020-bb1c-11f0-aedb-5b3735c7e119',productId:'02b809f20e024bce47c57f123cff8735', data: { origen: 'boton_popup2' } });
    };
    document.getElementById('btn-autolaunch').onclick = () => {
      sdk.autoLaunch();
      alert('AutoLaunch activado: se disparar치 Popup 1 (tiempo) y Popup 2 (scroll).');
    };
    document.getElementById('btn-mark-answered').onclick = () => {
      sdk.markSurveyAnswered('a9c8c170-bb1c-11f0-9d29-d5fe3dd521d0');
      logEvent({ type: 'survey_completed', surveyId: 'a9c8c170-bb1c-11f0-9d29-d5fe3dd521d0',productId:'02b809f20e024bce47c57f123cff8735', timestamp: Date.now(), data: { manual: true } });
      alert('Marcada survey-001 como contestada. No se mostrar치 Popup 1 si la condici칩n answered:false est치 activa.');
    };
    document.getElementById('btn-force-survey').onclick = () => {
      sdk.triggerSurvey('dc278020-bb1c-11f0-aedb-5b3735c7e119');
    };
    document.getElementById('btn-clear-log').onclick = () => {
      logEl.innerHTML = '<div class="event">Log limpiado...</div>';
    };
  </script>
</body>
</html>
